require "colorize"

class Map
  def initialize
    @data =
      [
        "......................................................................S......................................................................",
        ".............................................................................................................................................",
        "......................................................................^......................................................................",
        ".............................................................................................................................................",
        ".....................................................................^.^.....................................................................",
        ".............................................................................................................................................",
        "....................................................................^.^.^....................................................................",
        ".............................................................................................................................................",
        "...................................................................^.....^...................................................................",
        ".............................................................................................................................................",
        "..................................................................^.^.^.^.^..................................................................",
        ".............................................................................................................................................",
        ".................................................................^.^.^.^...^.................................................................",
        ".............................................................................................................................................",
        "................................................................^.^.^.^...^.^................................................................",
        ".............................................................................................................................................",
        "...............................................................^.^.^.^.....^.^...............................................................",
        ".............................................................................................................................................",
        "..............................................................^...^.......^.^.^..............................................................",
        ".............................................................................................................................................",
        ".............................................................^.^.^.^.^.^.^...^.^.............................................................",
        ".............................................................................................................................................",
        "............................................................^.^.^.^...^.^.^...^.^............................................................",
        ".............................................................................................................................................",
        "...........................................................^.^.^.....^.^.^.^.^.^.^...........................................................",
        ".............................................................................................................................................",
        "..........................................................^...^.^.^...^.^...^.^.^.^..........................................................",
        ".............................................................................................................................................",
        ".........................................................^.^.^.^.^...^.^.^...^.^.^.^.........................................................",
        ".............................................................................................................................................",
        "........................................................^.^.^.^.^...........^.^.^.^.^........................................................",
        ".............................................................................................................................................",
        ".......................................................^.......^.^.^.^.^.^.^.^.^.^.^.^.......................................................",
        ".............................................................................................................................................",
        "......................................................^.^...^.^.^...^.^.^...^...^.^...^......................................................",
        ".............................................................................................................................................",
        ".....................................................^.....^...^.^.^.^.^.^.....^.....^.^.....................................................",
        ".............................................................................................................................................",
        "....................................................^...^.^.^.^...^...^.^.^.^.^...^.^.^.^....................................................",
        ".............................................................................................................................................",
        "...................................................^.^...^.^.^...^.^...^.^.^.^.^.^.^.^...^...................................................",
        ".............................................................................................................................................",
        "..................................................^...^.^.^.....^.......^.^.^.^.^...^.^.^.^..................................................",
        ".............................................................................................................................................",
        ".................................................^.^.^.^.^.^...^.^...^.^.^.^.........^.^.^.^.................................................",
        ".............................................................................................................................................",
        "................................................^.^.^.^.^...^.^...^.^.^.^.^...^.^...^.^...^.^................................................",
        ".............................................................................................................................................",
        "...............................................^.^...^.^...........^...^.^.^.^.^...^.^.^.^...^...............................................",
        ".............................................................................................................................................",
        "..............................................^.......^...^.....^.^...^.^.^.^.^.^.^.^.^...^.^.^..............................................",
        ".............................................................................................................................................",
        ".............................................^.^...^...^...^...^.....^...^.^.^.^.^...^.^.^.^.^.^.............................................",
        ".............................................................................................................................................",
        "............................................^.^.^.^.^.^...^.^...^.^...^...^.^.^...^.^.^.^.....^.^............................................",
        ".............................................................................................................................................",
        "...........................................^.^.....^.^.^...^.^.^.^...^.^.^.^.^.....^.^.^.^.^...^.^...........................................",
        ".............................................................................................................................................",
        "..........................................^...^.^.^.^...^.^.^.^...^.....^...^.^.^.....^.^...^.^...^..........................................",
        ".............................................................................................................................................",
        ".........................................^.^...^.^.^.^.^.^.^.^.^.......^.....^.^.^.^.......^.^.^.^.^.........................................",
        ".............................................................................................................................................",
        "........................................^...^.^...^...^.^.^...^...^...^.^.^.^.^.^.^...^.^.^.^.^...^.^........................................",
        ".............................................................................................................................................",
        ".......................................^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^.^.^...^.^.^.^.......................................",
        ".............................................................................................................................................",
        "......................................^.^.^...^.^.....^.^.^...^.^.^...^.^.^...^.^...^.^.......^.....^.^......................................",
        ".............................................................................................................................................",
        ".....................................^.^.......^.^...^...^.^...^.^.^.^.^.....^.^.^...^.^.^...^.^.......^.....................................",
        ".............................................................................................................................................",
        "....................................^...^.^.......^.^.^.^.^.^.^.^.......^.^...^...^.^.^.^.^.^.^.^.^.^...^....................................",
        ".............................................................................................................................................",
        "...................................^.^...^.^.^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.^.^.^.......^.^.^.^.^.^.^...................................",
        ".............................................................................................................................................",
        "..................................^.....^...^.^.....^.^...^.^.....^...^.....^.....^.^.^.^.^.......^.^.^...^..................................",
        ".............................................................................................................................................",
        ".................................^.....^.^.^.^.^...^.^.^...^...^...^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.................................",
        ".............................................................................................................................................",
        "................................^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.....^.^.^................................",
        ".............................................................................................................................................",
        "...............................^...^.^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^...^.^...^.^.....^.^.^.^.^...............................",
        ".............................................................................................................................................",
        "..............................^.^.^.^.^.^.^...^.^.....^.....^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^..............................",
        ".............................................................................................................................................",
        ".............................^.^.^.^.^.^.^.^...^...^.^.^...^...^...^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.............................",
        ".............................................................................................................................................",
        "............................^.^...^.^.^.^.^.^.....^.^.^...^.....^.^...^.^...^.^.......^.^.^.^.^.^.^.^.^.^.^.^.^.^............................",
        ".............................................................................................................................................",
        "...........................^.^.^.^.^.^.^.....^...^.^.....^.^...^.^...^.....^.^.^...^.^.^.^.^.^.^.....^...^.^.^.^.^...........................",
        ".............................................................................................................................................",
        "..........................^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....^.......^.^...^.^.^.^.^.^.^.^.........^.^.^.^...^..........................",
        ".............................................................................................................................................",
        ".........................^.^.^.^.^.......^.^.^.^.^.^.^...^.^.......^.^.^.....^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^...^.........................",
        ".............................................................................................................................................",
        "........................^.^.^.^.^.^...^...^...^.^...^...^.^.^...^...^.^.^.^.......^.....^.^...^.^.^.....^.^...^.^...^........................",
        ".............................................................................................................................................",
        ".......................^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.....^...^...^.^.......^.^.^.....^.^.^.^...^.^.^.......................",
        ".............................................................................................................................................",
        "......................^...^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.......^.^.....^.^.....^.^.^...^.^.^.^.^...^.^...^.^.^...^......................",
        ".............................................................................................................................................",
        ".....................^...^.^.^.^.^.^.^.^.....^.^.....^.^.^.^...^.^.^.^.^.^.^.....^.^...^.....^.^.....^.^.^.^...^.......^.....................",
        ".............................................................................................................................................",
        "....................^.^.^.^...^.....^...^.^.^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^.....^.^...^.^....................",
        ".............................................................................................................................................",
        "...................^.^.^.^...^...^.^.....^.^...^.^.......^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.....^.^...^.^.^.^...................",
        ".............................................................................................................................................",
        "..................^.....^...^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^.....^.^.^.^.^.^...^.^...^.^...^.^.^.^.^.^.^...^.^..................",
        ".............................................................................................................................................",
        ".................^...^.^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.....^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.................",
        ".............................................................................................................................................",
        "................^.^...^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.^.^.^.........^.^.......^...^.^.^.^.^.^.......^.....^...^.^...^................",
        ".............................................................................................................................................",
        "...............^.^...^.^.^.^.^.^.....^.....^.^.....^.^.^.^.....^...^.^.^...^...^.^.^.^...^...^.^.^.^.^.^...^...^...^...^.^.^.^...............",
        ".............................................................................................................................................",
        "..............^.^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.........^.^...^.....^.^.^.^.^.^.........^.^.^.^...^.^.^.^.^...^.^...^.^.^.^..............",
        ".............................................................................................................................................",
        ".............^.^.^.^...^.^.^.^...^.^.......^.^.^.^...^.^.........^.....^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.^...^.^.....^.^.............",
        ".............................................................................................................................................",
        "............^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^...^.^...^.^.^...^.^.^.^.^...^.....^............",
        ".............................................................................................................................................",
        "...........^.^.^.^.^...^.^.^.^...^.^.^.^...^.....^.........^.^...^...^...^.^...^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^...........",
        ".............................................................................................................................................",
        "..........^.^.^.^...^...^.^...^...^.^.^...^.^.^.^.^.^...^.^...^...^.........^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^...^.^..........",
        ".............................................................................................................................................",
        ".........^.^.^...^.^...^...^...^.^.^...^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^.^...^...^.........",
        ".............................................................................................................................................",
        "........^.^.^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^...^.....^.^...^.^.^...^.^.^.^...^.^.^.....^.^.^.^.^...^.^........",
        ".............................................................................................................................................",
        ".......^.^.^.^.^.^...^.^...^.^...^.....^.^...^.^...^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.....^.^.^...^.^.^.^...^...^...^.^.^.^.^...^.^.^.......",
        ".............................................................................................................................................",
        "......^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.....^.........^.^.^.^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^.^.^.^.^.....^......",
        ".............................................................................................................................................",
        ".....^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.....^...^.^.^.....^.^.^.^.^.^.^.^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.^.....",
        ".............................................................................................................................................",
        "....^.^.^.^.^...^.^.....^.^...^...^.^.^.^.^...^.^.^.^.^.....^.^.^.^...^.^...^...^.^.^.^...^.^.....^.^.^.^.....^.^.^...^.......^.^.^.^...^....",
        ".............................................................................................................................................",
        "...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.....^.^.^.^.^.^.^.^.^...^...^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...",
        ".............................................................................................................................................",
        "..^.^.^...^.^.....^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.....^.....^.^.^.^.....^...^...^.^.^.....^.^.^.^.^.^...^...^.^..",
        ".............................................................................................................................................",
        ".^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.....^.^...^.^.^.^.^...^.^...^.^.^...^.^...^...^.^.^.^.^.^...^.^.^...^.^...^.^.^.^...^.^...^.^.^.^.^.^.^.",
        ".............................................................................................................................................",
      ]

    @data1 =
      [
        ".......S.......",
        "...............",
        ".......^.......",
        "...............",
        "......^.^......",
        "...............",
        ".....^.^.^.....",
        "...............",
        "....^.^...^....",
        "...............",
        "...^.^...^.^...",
        "...............",
        "..^...^.....^..",
        "...............",
        ".^.^.^.^.^...^.",
        "...............",
      ]
  end

  def read
    @data
  end
end


class Part1
  def initialize(map)
    @total = 0
    @data = map.new.read
    dimensions
    row = @data[0]
  end

  def dimensions
    @w_max = @data[0].size
    @h_max = @data.size
  end

  def process_row(row, row_count)
    return gen_row_1(row) if(row_count == 0)
    gen_new_row(row, row_count)
  end

  def gen_blank_row
    '.' * @w_max
  end

  def gen_row_1(row)
    new_row = gen_blank_row
    idx = 0
    row.each_byte do |c|
      if c.chr == 'S'
        new_row[idx] = '|'
      end
      idx += 1
    end
    new_row
  end

  def beam_left(row, idx)
    row[idx - 1] = '|'
  end

  def beam_fwd(row, idx)
    row[idx] = '|'
  end

  def beam_right(row, idx)
    row[idx + 1] = '|'
  end

  def split_beam(row, idx)
    beam_left(row, idx)
    beam_right(row, idx)
  end

  def continue_beam(row, idx)
    row[idx] = '|'
  end

  def gen_new_row(row, row_count)
    @data = Map.new.read
    next_row = @data[row_count + 1]
    idx = 0

    row.each_byte do |c|
      if c.chr == '|'
        if next_row[idx] == '^'
          @total += 1
          split_beam(next_row, idx)
        else
          continue_beam(next_row, idx)
        end
      end
      idx += 1
    end

    next_row
  end

  def run
    row = @data[0]
    (0...@w_max).each do |row_count|
      if row_count < (@h_max - 1)
        row = process_row(row, row_count)
      end
    end
    @total
  end
end

puts "\n\n.   .   start   .   .".colorize(mode: :bold, color: :white)

total = Part1.new(Map).run

puts "Total: #{total}".colorize(mode: :bold, color: :red)
