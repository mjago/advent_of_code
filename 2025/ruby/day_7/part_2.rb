require "colorize"

@boxes = []
@w_max = 0
@h_max = 0
@data =
  [
    "......................................................................S......................................................................",
    ".............................................................................................................................................",
    "......................................................................^......................................................................",
    ".............................................................................................................................................",
    ".....................................................................^.^.....................................................................",
    ".............................................................................................................................................",
    "....................................................................^.^.^....................................................................",
    ".............................................................................................................................................",
    "...................................................................^.....^...................................................................",
    ".............................................................................................................................................",
    "..................................................................^.^.^.^.^..................................................................",
    ".............................................................................................................................................",
    ".................................................................^.^.^.^...^.................................................................",
    ".............................................................................................................................................",
    "................................................................^.^.^.^...^.^................................................................",
    ".............................................................................................................................................",
    "...............................................................^.^.^.^.....^.^...............................................................",
    ".............................................................................................................................................",
    "..............................................................^...^.......^.^.^..............................................................",
    ".............................................................................................................................................",
    ".............................................................^.^.^.^.^.^.^...^.^.............................................................",
    ".............................................................................................................................................",
    "............................................................^.^.^.^...^.^.^...^.^............................................................",
    ".............................................................................................................................................",
    "...........................................................^.^.^.....^.^.^.^.^.^.^...........................................................",
    ".............................................................................................................................................",
    "..........................................................^...^.^.^...^.^...^.^.^.^..........................................................",
    ".............................................................................................................................................",
    ".........................................................^.^.^.^.^...^.^.^...^.^.^.^.........................................................",
    ".............................................................................................................................................",
    "........................................................^.^.^.^.^...........^.^.^.^.^........................................................",
    ".............................................................................................................................................",
    ".......................................................^.......^.^.^.^.^.^.^.^.^.^.^.^.......................................................",
    ".............................................................................................................................................",
    "......................................................^.^...^.^.^...^.^.^...^...^.^...^......................................................",
    ".............................................................................................................................................",
    ".....................................................^.....^...^.^.^.^.^.^.....^.....^.^.....................................................",
    ".............................................................................................................................................",
    "....................................................^...^.^.^.^...^...^.^.^.^.^...^.^.^.^....................................................",
    ".............................................................................................................................................",
    "...................................................^.^...^.^.^...^.^...^.^.^.^.^.^.^.^...^...................................................",
    ".............................................................................................................................................",
    "..................................................^...^.^.^.....^.......^.^.^.^.^...^.^.^.^..................................................",
    ".............................................................................................................................................",
    ".................................................^.^.^.^.^.^...^.^...^.^.^.^.........^.^.^.^.................................................",
    ".............................................................................................................................................",
    "................................................^.^.^.^.^...^.^...^.^.^.^.^...^.^...^.^...^.^................................................",
    ".............................................................................................................................................",
    "...............................................^.^...^.^...........^...^.^.^.^.^...^.^.^.^...^...............................................",
    ".............................................................................................................................................",
    "..............................................^.......^...^.....^.^...^.^.^.^.^.^.^.^.^...^.^.^..............................................",
    ".............................................................................................................................................",
    ".............................................^.^...^...^...^...^.....^...^.^.^.^.^...^.^.^.^.^.^.............................................",
    ".............................................................................................................................................",
    "............................................^.^.^.^.^.^...^.^...^.^...^...^.^.^...^.^.^.^.....^.^............................................",
    ".............................................................................................................................................",
    "...........................................^.^.....^.^.^...^.^.^.^...^.^.^.^.^.....^.^.^.^.^...^.^...........................................",
    ".............................................................................................................................................",
    "..........................................^...^.^.^.^...^.^.^.^...^.....^...^.^.^.....^.^...^.^...^..........................................",
    ".............................................................................................................................................",
    ".........................................^.^...^.^.^.^.^.^.^.^.^.......^.....^.^.^.^.......^.^.^.^.^.........................................",
    ".............................................................................................................................................",
    "........................................^...^.^...^...^.^.^...^...^...^.^.^.^.^.^.^...^.^.^.^.^...^.^........................................",
    ".............................................................................................................................................",
    ".......................................^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^.^.^...^.^.^.^.......................................",
    ".............................................................................................................................................",
    "......................................^.^.^...^.^.....^.^.^...^.^.^...^.^.^...^.^...^.^.......^.....^.^......................................",
    ".............................................................................................................................................",
    ".....................................^.^.......^.^...^...^.^...^.^.^.^.^.....^.^.^...^.^.^...^.^.......^.....................................",
    ".............................................................................................................................................",
    "....................................^...^.^.......^.^.^.^.^.^.^.^.......^.^...^...^.^.^.^.^.^.^.^.^.^...^....................................",
    ".............................................................................................................................................",
    "...................................^.^...^.^.^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.^.^.^.......^.^.^.^.^.^.^...................................",
    ".............................................................................................................................................",
    "..................................^.....^...^.^.....^.^...^.^.....^...^.....^.....^.^.^.^.^.......^.^.^...^..................................",
    ".............................................................................................................................................",
    ".................................^.....^.^.^.^.^...^.^.^...^...^...^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.................................",
    ".............................................................................................................................................",
    "................................^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.....^.^.^................................",
    ".............................................................................................................................................",
    "...............................^...^.^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^...^.^...^.^.....^.^.^.^.^...............................",
    ".............................................................................................................................................",
    "..............................^.^.^.^.^.^.^...^.^.....^.....^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^..............................",
    ".............................................................................................................................................",
    ".............................^.^.^.^.^.^.^.^...^...^.^.^...^...^...^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.............................",
    ".............................................................................................................................................",
    "............................^.^...^.^.^.^.^.^.....^.^.^...^.....^.^...^.^...^.^.......^.^.^.^.^.^.^.^.^.^.^.^.^.^............................",
    ".............................................................................................................................................",
    "...........................^.^.^.^.^.^.^.....^...^.^.....^.^...^.^...^.....^.^.^...^.^.^.^.^.^.^.....^...^.^.^.^.^...........................",
    ".............................................................................................................................................",
    "..........................^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....^.......^.^...^.^.^.^.^.^.^.^.........^.^.^.^...^..........................",
    ".............................................................................................................................................",
    ".........................^.^.^.^.^.......^.^.^.^.^.^.^...^.^.......^.^.^.....^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^...^.........................",
    ".............................................................................................................................................",
    "........................^.^.^.^.^.^...^...^...^.^...^...^.^.^...^...^.^.^.^.......^.....^.^...^.^.^.....^.^...^.^...^........................",
    ".............................................................................................................................................",
    ".......................^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.....^...^...^.^.......^.^.^.....^.^.^.^...^.^.^.......................",
    ".............................................................................................................................................",
    "......................^...^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.......^.^.....^.^.....^.^.^...^.^.^.^.^...^.^...^.^.^...^......................",
    ".............................................................................................................................................",
    ".....................^...^.^.^.^.^.^.^.^.....^.^.....^.^.^.^...^.^.^.^.^.^.^.....^.^...^.....^.^.....^.^.^.^...^.......^.....................",
    ".............................................................................................................................................",
    "....................^.^.^.^...^.....^...^.^.^.^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^.....^.^...^.^....................",
    ".............................................................................................................................................",
    "...................^.^.^.^...^...^.^.....^.^...^.^.......^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.....^.^...^.^.^.^...................",
    ".............................................................................................................................................",
    "..................^.....^...^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^.....^.^.^.^.^.^...^.^...^.^...^.^.^.^.^.^.^...^.^..................",
    ".............................................................................................................................................",
    ".................^...^.^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.....^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.................",
    ".............................................................................................................................................",
    "................^.^...^.^.^.^.^.^.^...^.^.....^...^.^.....^.^.^.^.^.........^.^.......^...^.^.^.^.^.^.......^.....^...^.^...^................",
    ".............................................................................................................................................",
    "...............^.^...^.^.^.^.^.^.....^.....^.^.....^.^.^.^.....^...^.^.^...^...^.^.^.^...^...^.^.^.^.^.^...^...^...^...^.^.^.^...............",
    ".............................................................................................................................................",
    "..............^.^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.........^.^...^.....^.^.^.^.^.^.........^.^.^.^...^.^.^.^.^...^.^...^.^.^.^..............",
    ".............................................................................................................................................",
    ".............^.^.^.^...^.^.^.^...^.^.......^.^.^.^...^.^.........^.....^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.^...^.^.....^.^.............",
    ".............................................................................................................................................",
    "............^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^...^.^...^.^.^...^.^.^.^.^...^.....^............",
    ".............................................................................................................................................",
    "...........^.^.^.^.^...^.^.^.^...^.^.^.^...^.....^.........^.^...^...^...^.^...^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^...........",
    ".............................................................................................................................................",
    "..........^.^.^.^...^...^.^...^...^.^.^...^.^.^.^.^.^...^.^...^...^.........^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^...^.^..........",
    ".............................................................................................................................................",
    ".........^.^.^...^.^...^...^...^.^.^...^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^.^...^...^.........",
    ".............................................................................................................................................",
    "........^.^.^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^.^.^.^.^...^.^.^.^...^.....^.^...^.^.^...^.^.^.^...^.^.^.....^.^.^.^.^...^.^........",
    ".............................................................................................................................................",
    ".......^.^.^.^.^.^...^.^...^.^...^.....^.^...^.^...^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.....^.^.^...^.^.^.^...^...^...^.^.^.^.^...^.^.^.......",
    ".............................................................................................................................................",
    "......^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.....^.........^.^.^.^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^.^.^.^.^.....^......",
    ".............................................................................................................................................",
    ".....^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.....^...^.^.^.....^.^.^.^.^.^.^.^.^.....^...^.^.^.^.^.^...^.^.^.^.....^.^.^.....",
    ".............................................................................................................................................",
    "....^.^.^.^.^...^.^.....^.^...^...^.^.^.^.^...^.^.^.^.^.....^.^.^.^...^.^...^...^.^.^.^...^.^.....^.^.^.^.....^.^.^...^.......^.^.^.^...^....",
    ".............................................................................................................................................",
    "...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.....^.^.^.^.^.^.^.^.^...^...^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...",
    ".............................................................................................................................................",
    "..^.^.^...^.^.....^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.....^.....^.^.^.^.....^...^...^.^.^.....^.^.^.^.^.^...^...^.^..",
    ".............................................................................................................................................",
    ".^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.....^.^...^.^.^.^.^...^.^...^.^.^...^.^...^...^.^.^.^.^.^...^.^.^...^.^...^.^.^.^...^.^...^.^.^.^.^.^.^.",
    ".............................................................................................................................................",
  ]

@data1 =
  [
    ".......S.......",
    "...............",
    ".......^.......",
    "...............",
    "......^.^......",
    "...............",
    ".....^.^.^.....",
    "...............",
    "....^.^...^....",
    "...............",
    "...^.^...^.^...",
    "...............",
    "..^...^.....^..",
    "...............",
    ".^.^.^.^.^...^.",
    "...............",
  ]

def dimensions
  @w_max = @data[0].size
  @h_max = @data.size
end

def is_split?(w, h)
  row_next = next_row(h)
  return false unless row_next
  if row_next[w] == '^'
    return true
  end
  false
end

def gen_blank_row
  '.' * @w_max
end


def gen_row_1(row)
  new_row = gen_blank_row
  idx = 0
  row.each_byte do |c|
    if c.chr == 'S'
      new_row[idx] = '1'
    end
    idx += 1
  end
  new_row
end

def split_box(w)
  if @boxes[w - 1]
    @boxes[w - 1] += @boxes[w]
  else
    @boxes[w - 1] = @boxes[w]
  end

  if @boxes[w + 1]
    @boxes[w + 1] += @boxes[w]
  else
    @boxes[w + 1] = @boxes[w]
  end
  @boxes[w] = nil
end

def find_start
  idx = 0
  @data[0].each_byte do |c|
    if c.chr == 'S'
      return idx
    end
    idx += 1
  end
  raise("‚ùå Error: couldn't find start!");
end

def run
  dimensions
  @boxes = Array.new(@w_max)
  @boxes[find_start] = 1
  (1...@h_max).each do |h|
    (0...@w_max).each do |w|
      if(@data[h][w] == '^')
        if @boxes[w]
          split_box w
        end
      end
    end
  end
end

run
total = @boxes.compact.sum

puts "Total: #{total}".colorize(mode: :bold, color: :red)

